import Foundation

/// Нормализация строки для поиска: регистр и диакритика игнорируются, специфические буквы заменяются на аналоги
//public func normalizeForSearch(_ string: String) -> String {
//    let lowercased = string.lowercased()
//    let decomposed = lowercased.decomposedStringWithCanonicalMapping
//    let filtered = decomposed.unicodeScalars.filter { !$0.properties.isDiacritic }
//    var result = String(String.UnicodeScalarView(filtered))
//    
//    // Максимально расширенный словарь замен для разных языков
//    let replacements: [Character: String] = [
//        // Казахский, кириллица
//        "қ": "к", "Қ": "К",
//        "ң": "н", "Ң": "Н",
//        "ү": "у", "Ү": "У",
//        "ұ": "у", "Ұ": "У",
//        "ө": "о", "Ө": "О",
//        "һ": "х", "Һ": "Х",
//        "і": "и", "І": "И",
//        // Украинский
//        "є": "е", "Є": "Е",
//        "ї": "и", "Ї": "И",
//        "ґ": "г", "Ґ": "Г",
//        // Белорусский
//        "ў": "у", "Ў": "У",
//        // Болгарский/македонский
//        "ѝ": "и", "ѐ": "е",
//        // Польский
//        "ł": "l", "Ł": "L",
//        "ś": "s", "Ś": "S",
//        "ź": "z", "Ź": "Z",
//        "ż": "z", "Ż": "Z",
//        "ć": "c", "Ć": "C",
//        "ń": "n", "Ń": "N",
//        // Венгерский
//        "ő": "o", "Ő": "O",
//        "ű": "u", "Ű": "U",
//        // Турецкий
//        "ğ": "g", "Ğ": "G",
//        "ı": "i", "İ": "I",
//        // Латышский
//        "ķ": "k", "Ķ": "K",
//        "ļ": "l", "Ļ": "L",
//        "ņ": "n", "Ņ": "N",
//        "ģ": "g", "Ģ": "G",
//        // Литовский
//        "č": "c", "Č": "C",
//        "š": "s", "Š": "S",
//        "ž": "z", "Ž": "Z",
//        // Румынский
//        "ț": "t", "Ț": "T",
//        "ş": "s", "Ş": "S",
//        // Французский/немецкий/испанский/итальянский
//        "ß": "ss",
//        "œ": "oe", "Œ": "OE",
//        // Скандинавские языки
//        "ø": "o", "Ø": "O",
//        "å": "a", "Å": "A",
//        "æ": "ae", "Æ": "AE",
//        "ð": "d", "Ð": "D",
//        "þ": "th", "Þ": "Th",
//        // Сербский/македонский
//        "ђ": "д", "Ѓ": "Г", "ѓ": "г", "ј": "й", "љ": "л", "њ": "н", "ћ": "т", "џ": "д",
//        // Греческий (транслитерация)
//        "α": "a", "β": "v", "γ": "g", "δ": "d", "ε": "e", "ζ": "z", "η": "i", "θ": "th", "ι": "i", "κ": "k", "λ": "l", "μ": "m", "ν": "n", "ξ": "x", "ο": "o", "π": "p", "ρ": "r", "σ": "s", "ς": "s", "τ": "t", "υ": "y", "φ": "f", "χ": "ch", "ψ": "ps", "ω": "o",
//        "Α": "A", "Β": "V", "Γ": "G", "Δ": "D", "Ε": "E", "Ζ": "Z", "Η": "I", "Θ": "TH", "Ι": "I", "Κ": "K", "Λ": "L", "Μ": "M", "Ν": "N", "Ξ": "X", "Ο": "O", "Π": "P", "Ρ": "R", "Σ": "S", "Τ": "T", "Υ": "Y", "Φ": "F", "Χ": "CH", "Ψ": "PS", "Ω": "O",
//        // Редкие латинские
//        "đ": "d", "Đ": "D", "ŋ": "n", "Ŋ": "N",
//        // Арабский (пример)
//        "ء": "", "آ": "a", "أ": "a", "ؤ": "u", "إ": "i", "ئ": "i", "ا": "a", "ب": "b", "ة": "h", "ت": "t", "ث": "th", "ج": "j", "ح": "h", "خ": "kh", "د": "d", "ذ": "dh", "ر": "r", "ز": "z", "س": "s", "ش": "sh", "ص": "s", "ض": "d", "ط": "t", "ظ": "z", "ع": "a", "غ": "gh", "ف": "f", "ق": "q", "ك": "k", "ل": "l", "م": "m", "ن": "n", "ه": "h", "و": "w", "ي": "y",
//        // Иврит (пример)
//        "א": "a", "ב": "b", "ג": "g", "ד": "d", "ה": "h", "ו": "v", "ז": "z", "ח": "h", "ט": "t", "י": "y", "כ": "k", "ל": "l", "מ": "m", "נ": "n", "ס": "s", "ע": "a", "פ": "p", "צ": "ts", "ק": "k", "ר": "r", "ש": "sh", "ת": "t",
//        // Грузинский (пример)
//        "ა": "a", "ბ": "b", "გ": "g", "დ": "d", "ე": "e", "ვ": "v", "ზ": "z", "თ": "t", "ი": "i", "კ": "k", "ლ": "l", "მ": "m", "ნ": "n", "ო": "o", "პ": "p", "ჟ": "zh", "რ": "r", "ს": "s", "ტ": "t", "უ": "u", "ფ": "p", "ქ": "k", "ღ": "gh", "ყ": "q", "შ": "sh", "ჩ": "ch", "ც": "ts", "ძ": "dz", "წ": "ts", "ჭ": "ch", "ხ": "kh", "ჯ": "j", "ჰ": "h",
//        // Армянский (пример)
//        "ա": "a", "բ": "b", "գ": "g", "դ": "d", "ե": "e", "զ": "z", "է": "e", "ը": "y", "թ": "t", "ժ": "zh", "ի": "i", "լ": "l", "խ": "kh", "ծ": "ts", "կ": "k", "հ": "h", "ձ": "dz", "ղ": "gh", "ճ": "ch", "մ": "m", "յ": "y", "ն": "n", "շ": "sh", "ո": "o", "չ": "ch", "պ": "p", "ջ": "j", "ռ": "r", "ս": "s", "վ": "v", "տ": "t", "ր": "r", "ց": "ts", "ւ": "v", "փ": "p", "ք": "q", "օ": "o", "ֆ": "f"
//        // ...можно расширять по необходимости...
//    ]
//    // Для букв, где замена на 2+ символа, используем flatMap
//    result = result.compactMap { replacements[$0] ?? String($0) }.joined()
//    
//#if DEBUG
//    Log.debug("normalize for search result: \(result)")
//#endif
//    
//    return result
//}

/// Сравнивает две строки, игнорируя диакритические знаки и регистр.
public func equalsIgnoreDiacriticsAndCase(_ lhs: String, _ rhs: String) -> Bool {
    return removeDiacritics(lhs) == removeDiacritics(rhs)
}

/// Проверяет вхождение строки, игнорируя диакритические знаки и регистр.
public func containsIgnoreDiacriticsAndCase(_ string: String, _ substring: String) -> Bool {
    return removeDiacritics(string).contains(removeDiacritics(substring))
}

/// Удаляет диакритические знаки из строки (без дополнительных замен)
public func removeDiacritics(_ string: String) -> String {
    let lowercased = string.lowercased()
    let decomposed = lowercased.decomposedStringWithCanonicalMapping
    let filtered = decomposed.unicodeScalars.filter { !$0.properties.isDiacritic }
    return String(String.UnicodeScalarView(filtered))
}
